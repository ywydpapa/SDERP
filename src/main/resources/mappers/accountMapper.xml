<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="account">

<select id="listVat" resultType="accountDto">
	select a.*, b.custName vatSellerName, c.custName vatBuyerName, sum(d.dataAmt) vatSum from swc_vat a
			   left join swc_cust b on a.vatSellerCustNo = b.custNo
			   left join swc_cust c on a.vatBuyerCustNo = c.custNo
			   left join swc_soppdata01 d on a.vatSerial = d.vatSerial and d.attrib not like 'XXX%'
	where a.compNo = #{compNo} and a.attrib not like 'XXX%' group by vatSerial

</select>

	<select id="detailVat" resultType="accountDto">
		select * from swc_vat where vatId = #{vatId};
	</select>

	<select id="listVatitems" resultType="accountDto">
		select * from swc_vatdata where vatId = #{vatId};
	</select>

	<select id="modalVatB" resultType="accountDto">
		select a.*, b.custName from swc_vat a left join swc_cust b on a.vatSellerCustNo = b.custNo where a.vatStatus in ('B1','B3') and a.attrib not like 'XXX%' and a.compNo = #{compNo}
	</select>

	<select id="modalVatS" resultType="accountDto">
		select a.*, b.custName from swc_vat a left join swc_cust b on a.vatSellerCustNo = b.custNo where a.vatStatus in ('S1','S3') and a.attrib not like 'XXX%' and a.compNo = #{compNo}
	</select>

	<select id="checkVat" resultType="accountDto">
		select count(*) as resultCount from swc_vat where vatSerial = #{vatSerial}
	</select>
	
	<select id="checkBac" resultType="accountDto">
		select count(*) as resultCount from swc_bac where bacSerial = #{bacSerial}
	</select>

	<select id="baclist" resultType="accountDto">
		select c.desc03 bacTypeN ,b.desc03 bankCodeN ,a.* from swc_bac a
																   left join swc_code b on b.code03 = a.bankCode
																   left join swc_code c on c.code03 = a.bacType
		where a.compNo = #{compNo} and a.attrib not like 'XXX%';
	</select>

	<select id="baclog" resultType="accountDto">
		select * from swc_bacledger where bacSerial = #{bacSerial} and attrib not like 'XXX%' order by baclogTime;
	</select>
	
	<select id="selectVatCust" resultType="accountDto">
		select count(*) as count, custNo as getNo from swc_cust where custVatno = #{vatNo}
	</select>

	<insert id="insertbacledger">
		insert into swc_bacledger
		(
			compNo,
			bacSerial,
			inAmt,
			outAmt,
			baclogTime,
			logType,
			logRemark,
			balanceAmt,
			branchCode,
			linkDoc,
			regDate,
			attrib 
		) 
		values 
		(
			#{compNo},
			#{bacSerial},
			#{inAmt},
			#{outAmt},
			#{baclogTime},
			#{logType},
			#{logRemark},
			#{balanceAmt},
			#{branchCode},
			#{linkDoc},
			now(),
			'10000'
		);
	</insert>

	<insert id="insertbac">
		insert into swc_bac
		(
			bankCode,
			compNo,
			bacNo,
			bacSerial,
			bacIssueDate,
			lastUpdTime,
			bacOwner,
			bacType,
			bacBalance,
			regDate,
			attrib
		) 
		values 
		(
			#{bankCode},
			#{compNo},
			#{bacNo},
			#{bacSerial},
			#{bacIssueDate},
			#{lastUpdTime},
			#{bacOwner},
			#{bacType},
			#{bacBalance},
			now(),
			'100001'
		);
	</insert>


<insert id="insertVat">
	insert into swc_vat
	(
			compNo,
			vatBuyerCustNo,
			vatSellerCustNo,
			vatEmail,
			vatStatus,
			vatNo,
			vatSerial,
			vatIssueDate,
			vatTradeDate,
			vatTransDate,
			vatType,
			vatTax,
			vatAmount,
			vatRemark,
			vatIssueType,
			linkedDocNo,
			regDate,
	 		attrib)
		values 
	(
		#{compNo},
		#{vatBuyerCustNo},
		#{vatSellerCustNo},
		#{vatEmail},
		#{vatStatus},
		#{vatNo},
		#{vatSerial},
		#{vatIssueDate},
		#{vatTradeDate},
		#{vatTransDate},
		#{vatType},
		#{vatTax},
		#{vatAmount},
		#{vatRemark},
		#{vatIssueType},
		#{linkedDocNo},
		now(),
		'100001'
	);
</insert>

	<insert id="insertVatItem">
		insert into swc_vatdata
(vatId,
tradeDate,
itemNo,
itemTitle,
itemUnit,
itemNetprice,
itemQuty,
itemAmount,
itemVat,
itemRemark,
linkedDocNo,
regDate,
attrib) values (#{vatId},
				#{tradeDate},
				#{itemNo},
				#{itemTitle},
				#{itemUnit},
				#{itemNetprice},
				#{itemQuty},
				#{itemAmount},
				#{itemVat},
				#{itemRemark},
				#{linkedDocNo},
				now(),
				'100001');
	</insert>

	<update id="updVatStatus">
		update swc_vat set vatStatus=#{vatStatus} where vatSerial = #{vatSerial};
	</update>
	
	<select id="connect_list" resultType="accountDto">
		select * from swc_soppdata01
		left join swc_user on swc_soppdata01.userNo = swc_user.userNo
		LEFT JOIN swc_sopp on swc_soppdata01.soppNo = swc_sopp.soppNo
		where vatSerial = #{vatSerial} and swc_soppdata01.attrib not like 'XXX%'
	</select>
</mapper>